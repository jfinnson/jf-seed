/*! jf-seed - v0.0.1 - 2015-07-17
 * Copyright (c) 2015 ; */angular.module("app",["ui.router","app.config","app.marketplace.templates","app.shared","app.marketplace"]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.when("","/home"),t.when("/","/home"),t.otherwise("/home"),e.state("home",{url:"/home",templateUrl:"templates/marketplace/main/mainPage.html",controller:"SystemController"}).state("about",{url:"/about",templateUrl:"templates/shared/support/about.html",controller:"AboutController"}).state("test",{url:"/test",templateUrl:"templates/shared/support/testing.html",controller:"TestingController"}).state("test.state1",{url:"/state1",templateUrl:"templates/shared/support/testing-state1.html"}).otherwise({redirectTo:"/"}),$(document).bind("pagebeforechange",function(e,t){var n=t.toPage,r=t.options.fromPage;n&&n.attr&&r&&r.attr&&n.attr("id")===r.attr("id")&&e.preventDefault()})}]).run(["$route","$rootScope","$location","$timeout","$window","$compile","apiUrl",function(e,t,n){t.$on("$routeChangeSuccess",function(){});var r=n.path;n.path=function(i){var o=e.current,a=t.$on("$locationChangeSuccess",function(){e.current&&e.current.params&&o!==e.current&&(t.currentRoute=e.current.params),o&&""!==o.$$route.originalPath&&(e.current=o),a()});return r.apply(n,[i])}}]),angular.module("app.config",[]).constant("apiUrl","http://localhost:5000").constant("marketplaceUrl","http://localhost:8000").constant("searchUrl","http://localhost:9200").constant("apiKey","77dc92d4-2368-498b-a8a2-cb359e637f5b").constant("apiSecret","571c91e3c18b45178df98a32").constant("TemplatePaths",{marketplace:"marketplace",shared:"shared"}).constant("membershipTypes",[{id:"team",name:"Team Member"},{id:"manager",name:"Manager"},{id:"executive",name:"Executive"},{id:"master",name:"Master"}]).constant("defaultPaginationOptions",{currentPage:1,totalItems:1,maxSize:5,itemsPerPage:20}),angular.module("app.marketplace.elements",["app.config"]),angular.module("app.marketplace",["app.config","app.marketplace.system","app.marketplace.support","app.marketplace.elements","ui.keypress"]),angular.module("app.marketplace.support",[]),angular.module("app.marketplace.system",[]),angular.module("app.marketplace.ui",[]),angular.module("app.shared",["app.config","ui.keypress","app.shared.ui","app.shared.system","app.shared.support"]),angular.module("app.shared.support",[]),angular.module("app.shared.system.api",[]),angular.module("app.shared.system",["app.shared.system.api"]),angular.module("app.shared.ui",[]),angular.module("app.marketplace.elements").service("accountModel",["serverAPI",function(){this.model_data={name:"account",display_name:"Account",api:{multiple:function(){return"accounts"},single:function(e){if(!checkNested(e,"data","account_id"))throw"Missing option(s) for account path 'single'. Options: "+e;return"account/"+e.data.account_id}},STORAGE_ID:"account",STORAGE_ID_LAST:"account-LastLogin",table_display:{}},this.fields={id:{display_name:"id",required:!0,api:{submit:!0},type:"string"},name:{display_name:"Login name",required:!0,api:{submit:!0},type:"string"},password:{display_name:"Login password",required:!0,api:{submit:!0},type:"password"},type:{display_name:"Login type",required:!1,type:"code",values:[{name:"admin",display_name:"Admin"}],api:{submit:!0}}},this.data={params:{model_name:"account"}}}]),angular.module("app").service("accountService",[function(){}]),angular.module("app.marketplace.elements").service("elementTreeManager",["serverAPI","apiUtils",function(){this.modelData={name:"elementTree",STORAGE_ID:"elementTree"},this.elementTree={params:{name:"elementTree",server:!1,fields:{treeMap:{display_name:"treeMap",type:"hashmap"},treeArrayMap:{display_name:"treeArrayMap",type:"hashmap"},rootType:{display_name:"rootType",type:"text"},exceptionType:{display_name:"rootType",type:"text"}}},f_data:{treeMap:{0:{}},treeArrayMap:{0:[]}},createTree:function(e){var t=null,n=null,r=this;for(var i in e)t=e[i],n=t.f_data.parentKey||t.f_data.parent_luid,!n&&t.f_data.parent_vLuid?n="v"+t.f_data.parent_vLuid:n||(n=this.f_data.rootType?t.f_data.type===this.f_data.rootType?0:null:0),null!==n&&(this.f_data.treeMap[n]||(this.f_data.treeMap[n]={},this.f_data.treeArrayMap[n]=[]),n&&e[n]&&(e[n].f_data.hasChildren=!0),this.f_data.treeMap[n][i]=t);var o=null,a=null,l=null,s=null,u=null,c=!1,d=null;for(i in this.f_data.treeMap){for(o=$.extend(!0,{},this.f_data.treeMap[i]),a=this.f_data.treeArrayMap[i],l=0,s=0,u=Object.keys(o).length;0!==Object.keys(o).length&&u*u>s;){if(d=Object.keys(o)[l],t=this.f_data.treeMap[i][d],c=!1,t.f_data.key||(t.f_data.key=d),r.f_data.rootType&&t.f_data.type!==r.f_data.rootType&&"0"===i)r.f_data.exceptionType&&t.f_data[r.f_data.exceptionType]||(this.f_data.treeArrayMap.misc||(this.f_data.treeArrayMap.misc=[]),this.f_data.treeArrayMap.misc.push(t)),c=!0;else if(t.f_data.previousKey){var p=null;for(var f in a)if(p=a[f],p.f_data.key===t.f_data.previousKey){a.splice(parseInt(f,10)+1,0,t),c=!0;break}}else a.length?(a.splice(0,0,t),c=!0):(a.push(t),c=!0);c&&delete o[d],l++,s++,l>=Object.keys(o).length&&(l=0)}if(Object.keys(o).length){this.f_data.treeArrayMap.misc||(this.f_data.treeArrayMap.misc=[]);for(var g in o)this.f_data.treeArrayMap.misc.push(o[g])}}this.elements=e},getTree:function(){return this.f_data.treeArrayMap},createKey:function(e,t){for(var n=0;!e.f_data.key||t[e.f_data.key]&&t[e.f_data.key]!==e;)e.f_data.key=e.f_data.luid||"v"+(e.f_data.vLuid+n),n>0&&e.f_data.luid,n++},addEle:function(e,t){if(!e||!e.f_data.key)return null;var n=0;if(t&&(t.f_data.luid?(e.f_data.parent_luid=t.f_data.luid,e.f_data.parentKey=t.f_data.luid):(e.f_data.parent_vLuid=t.f_data.vLuid,e.f_data.parentKey=t.f_data.key||"v"+e.f_data.parent_vLuid),n=e.f_data.parentKey,e.f_data.parent_element=t,t.f_data.hasChildren=!0),this.f_data.treeMap[n]||(this.f_data.treeMap[n]={}),this.f_data.treeArrayMap[n]||(this.f_data.treeArrayMap[n]=[]),this.f_data.treeMap[n][e.f_data.key]=e,this.f_data.treeArrayMap[n].push(e),this.f_data.treeArrayMap[n].length>1){var r=this.f_data.treeArrayMap[n][this.f_data.treeArrayMap[n].length-2];e.f_data.previous_luid=r.f_data.luid,e.f_data.previousKey=r.f_data.key}},removeElement:function(e){if(!e)return!1;var t=e.f_data.parentKey||0;delete this.f_data.treeMap[t][e.f_data.key];var n=this.f_data.treeArrayMap[t];for(var r in n)if(n[r]===e){if(r=parseInt(r,10),n.length>r+1){var i=r>0?n[r-1].f_data.luid:null,o=r>0?n[r-1].f_data.key:null;n[r+1].f_data.previous_luid=i,n[r+1].f_data.previousKey=o}n.splice(r,1)}},updateElement:function(e,t,n,r,i,o){if(!e||!t&&!n||null===r||void 0===r||!i||null===o||void 0===o)return console.log("error: updateElement",arguments),!1;o=parseInt(o,10);var a=this.elements[e],l=a.f_data.parentKey,s=0;n&&(s=n.f_data.key);var u=null;if(n&&(u=n.f_data.luid),!t&&s){var c=s;this.f_data.treeMap[c]||(this.f_data.treeMap[c]={}),this.f_data.treeArrayMap[c]||(this.f_data.treeArrayMap[c]=[]),t=this.f_data.treeArrayMap[c],n.open=!0}if(t!==i){var d=this.f_data.treeMap[a.f_data.parentKey||0],p=this.f_data.treeMap[s];p[e]=d[e],delete d[e],a.f_data.parentKey=s,a.f_data.parent_luid=u}if(t!==i||o!==r){var f=null,g=null;t.length>r&&(f=a.f_data.luid,g=a.f_data.key,t[r].f_data.previous_luid=f,t[r].f_data.previousKey=g),i.length>o+1&&(f=o>0?i[o-1].f_data.luid:null,g=o>0?i[o-1].f_data.key:null,i[o+1].f_data.previous_luid=f,i[o+1].f_data.previousKey=g),r>0?(f=t[r-1].f_data.luid,g=t[r-1].f_data.key,a.f_data.previous_luid=f,a.f_data.previousKey=g):(a.f_data.previous_luid=null,a.f_data.previousKey=null)}!t.length&&n&&(n.f_data.hasChildren=!0),t.splice(r,0,i.splice(o,1)[0]),!i.length&&i!==t&&l&&(this.elements[l].f_data.hasChildren=!1)}}}]),angular.module("app.marketplace.elements").service("elementSrv",["onlineUtils","serverAPI","accountModel","productModel","$rootScope","$q","$timeout","apiUrl",function(e,t,n,r,i,o,a,l){var s={account:n,product:r},u={},c={},d=[],p=null;for(var f in s)u[f]=1,c[f]={},d.push(f);var g=null,h=null,m=null,v=function(e){return e&&s[e]?s[e]:!1},w=function(e,t){t||(t={});var n=$.extend(!0,t||{},e.data);b(e,n),e.autofill&&e.autofill(n),n.vID=u[e.model_data.name]++;var r=n.id||"v"+n.vID,i=c[e.model_data.name][r]&&c[e.model_data.name][r].UI?c[e.model_data.name][r].UI:{};return n.UI=i,c[e.model_data.name][r]?angular.copy(n,c[e.model_data.name][r]):c[e.model_data.name][r]=n,c[e.model_data.name][r]},b=function(e,t){t.get=function(n){if(!e.fields[n])throw"Field "+n+" does not exist in model.";return y(e,t,n),t[n]},t.set=function(n,r){if(!e.fields[n])throw"Field "+n+" does not exist in model.";"object"===e.fields[n].type||"array"===e.fields[n].type?r&&angular.copy(r,t[n]):t[n]=r},t.getFieldParams=function(t){if(!e.fields[t])throw"Field "+t+" does not exist in "+e.model_data.name+" model.";return e.fields[t]}},y=function(e,t,n){var r=e.fields[n].type;t[n]||("object"===r&&(t[n]={}),"array"===r&&(t[n]=[]),e.fields[n].default_value&&(t[n]="object"===r||"array"===r?$.extend(!0,t[n],e.fields[n].default_value):e.fields[n].default_value))},C=function(e,t){if(!e||!e||!t)return!1;var n=v(t)[t],r=n.fields,i=e.b_data||{},o={},a=null;for(var l in e)a=n.fields[l],a&&a.api&&a.api.submit&&(!r||r[l])&&(i[l]=e[l],o[l]=e[l]);return o},x=function(e,n,r){if(!e||!n&&!r||!r.pathType||"single"===r.pathType&&!r.id)throw"Missing field or option for api get.";if(!(!n||r&&r.forceAPI)&&c[e][n])return o(function(t){t(c[e][n])});n&&(r||(r={}),r.pathType="single");var i=v(e);if(!i.model_data.api||!i.model_data.api[r.pathType])throw"Path type, "+r.pathType+", does not exist for "+e;var a=i.model_data.api[r.pathType](r);return a===!1?!1:(a=l+a,t.doAPICall(a,r).then(function(e){if(!e||e.success===!1||"failed"===e.success)throw"Path "+a+" returned a failure response.";var t=e.data?e.data:e;if(t){$.isArray(t)||(t=[t]);var n={};for(var r in t){var o=t[r];o.b_data=$.extend(!0,{},t[r]),o=w(i,o),n[o.id]=o}return n}}))},S=function(e,t){if(!e||!v(e))throw"_getElements: Missing elementType.";return v(e),t||(t={}),t.pathType||(t.pathType="multiple"),x(e,null,t)};h=function(e,n){if(!e||!n||!n.pathType||"single"===n.pathType&&!n.element)throw"_submit: Missing field or option.";var r=v(e);if(!r.model_data.api||!r.model_data.api[n.pathType])throw"Path type, "+n.pathType+", does not exist for "+e;var i=[];!n.elements&&n.element?i.push(n.element):n.elements&&(i=n.elements);var a=function(n,r,i){return t.doAPICall(n,r).then(function(t){if(!t||t.success===!1||"failed"===t.success)throw"Path "+n+" returned a failure response.";var r=t.data?t.data:t;if(r){var o=m(i,r);c[e][o.id]=o}})},l=[],s=null,u=null;for(var d in i){s=i[d],u={},u.isAsync=!0;var p=C(s,e,n);u=$.extend(u,p);var f=r.model_data.api[n.pathType](u);if(f===!1)return!1;l.push(a(f,u,s))}return l&&l.length>0?o.all(l).then(function(e){return e&&1===e.length?e[0]:e}):!0},g=function(e,t,n){if(n||(n={}),!e||!t)throw"_validateFields: Missing type or instance.";var r=v(e),i=null,o=[];for(var a in r.fields)i={pass:!0},i&&i.pass||o.push(i);return o.length>0?o[0]:{pass:!0}},m=function(e,t){return e.b_data=$.extend(!0,e.b_data||{},t),e=$.extend(!0,e||{},t)};var E=function(e,n,r){var i=v(e);if(!e||!n||!i)throw"_remove: Missing type, model, or instance.";if(r&&(!i.model_data.api||!i.model_data.api.remove))throw"_remove: Missing remove api path type.";if(r&&n.id){var o=i.model_data.api.remove(n);return o===!1?!1:t.doAPICall(o,n).then(function(t){if(!t||t.success===!1||"failed"===t.success)throw"Path "+o+" returned a failure response.";delete c[e][n.id]})}return delete c[e][n.id],!0},T=function(){for(var e in s);},k=function(){},R=function(){i.get=x},D=function(){T(),R(),k()};return D(),{create:w,remove:E,validateFields:g,get:x,getElements:S,submit:h,elementNameMap:s,elementTypeList:d,elementMaps:c,elements:p}}]),angular.module("app").service("productModel",[function(){this.model_data={name:"product",display_name:"Product",api:{multiple:function(){return"/products"},single:function(e){if(!checkNested(e,"data","product_id"))throw"Missing option(s) for account path 'single'. Options: "+e;return"/product/"+e.data.product_id}}},this.autofill=function(){},this.fields={id:{display_name:"id",required:!0,api:{submit:!0},type:"integer"},name:{display_name:"name",required:!0,api:{submit:!0},type:"text"}},this.data={params:{model_name:"appliance"},getStatus:function(){return this.last_state}}}]),angular.module("d3",[]).factory("d3Service",["$document","$window","$q","$rootScope",function(e,t,n,r){function i(){r.$apply(function(){o.resolve(t.d3)})}var o=n.defer(),a={d3:function(){return o.promise}},l=e[0].createElement("script");l.type="text/javascript",l.async=!0,l.src="http://d3js.org/d3.v3.js",l.onreadystatechange=function(){"complete"===this.readyState&&i()},l.onload=i;var s=e[0].getElementsByTagName("body")[0];return s.appendChild(l),a}]),angular.module("app.marketplace.system").controller("SystemController",["$scope","$location","elementSrv",function(e,t,n){n.getElements("product").then(function(t){e.products=t}),e.$watch("account.id",function(e,t){})}]),angular.module("app.marketplace.system").service("systemService",[function(){}]),angular.module("app.shared.support").controller("AlertCtrl",["$scope","alertSrv",function(e,t){e.alertSrv=t,e.closeAlert=function(){e.alert=null}}]),angular.module("app.shared.support").service("alertSrv",["$timeout",function(e){var t=function(n,r,o,a,l){return i&&!a?(n.alert={type:"info",msg:""},e(function(){t(n,r,o,!0,l)},1e3),!1):(n.alert={type:o||"error",msg:r},n.showOverrideOpt=l,void 0)},n=function(e){e.alert.msg=""},r=0,i=!1;return{timedChange:function(n,o,a,l){r++;var s=r;i=!0,e(function(){s===r&&(t(n,o,a),i=!1)},l)},setAlert:t,closeAlert:n}}]),angular.module("app.shared.support").directive("ngRightClick",["$parse",function(e){return function(t,n,r){var i=e(r.ngRightClick);n.bind("contextmenu",function(e){t.$apply(function(){e.preventDefault(),i(t,{$event:e})})})}}]).directive("jfBlur",["$document",function(e){return{restrict:"A",link:function(t,n,r){n.bind("click",function(e){e.stopPropagation()}),t.$watch(r.jfBlur,function(n,i){if(n!==i&&n){var o=!0;e.bind("click",function(e){o||(t[r.jfBlur]=!1,$(this).unbind(e),t.$apply()),o=!1})}})}}}]),angular.module("app.shared.support").run(function(){window.checkNested=function(e){for(var t=Array.prototype.slice.call(arguments,1),n=0;t.length>n;n++){if(!e||!e.hasOwnProperty(t[n]))return!1;e=e[t[n]]}return!0}}),angular.module("app.shared.system.api").service("serverAPI",["$http",function(e){var t=function(t,n){if(!t)throw"Empty fromUrl passed";return n||(n={}),e({url:t,async:n.isAsync||!1,dataType:n.dataType,data:n.dataContent,method:n.method||"GET"}).success(function(){}).error(function(e,n){throw"Error with api call: "+t+". Error status: "+n})};return{doAPICall:t}}]),angular.module("app.shared.system.api").service("socketSrv",["$rootScope",function(e){var t=null,n=1,r=0,i={},o=null,a=e,l=function(e,t){o=e,t&&(a=t),s()},s=function(){return o?(t=new WebSocket(o),t.onopen=function(){a.$emit("websocket-status",{status:"open",message:"Websocket Open"}),console.log("Opened websocket"),n=1,this.send('{ "type": "login", "account_type": "client", "token" : "'+e.account.token+'"}')},t.onclose=function(){a.$emit("websocket-status",{status:"error",message:"Websocket closed"});var e=p(n);setTimeout(function(){n++,s()},e)},t.onerror=function(e){a.$emit("websocket-status",{status:"error",message:"Websocket error"}),console.log("Websocket error: "+e)},t.onmessage=function(e){console.log("Websocket message: ",e.data);var t=JSON.parse(e.data);$.isPlainObject(t)&&t.body&&(t.body.datetime=""+new Date,t.body.id=r++),c(t)},void 0):!1},u=function(e,n,r){"tag"in e&&(e.tag in this.callbacks&&console.log("Problem! Tag already exists in callbacks"),this.callbacks[e.tag]={timeout:r||60,callback:n}),t.send(JSON.stringify(e))},c=function(e){switch(e.type){case"command_response":e.command_tag in i?i[e.command_tag].callback(e):console.log("No callback for tag <"+e.tag+"> in the callback queue");break;case"command":break;case"status_update":a.$emit("websocket-status_update",e.body);break;default:console.log("Unknown message from websocket")}},d=function(e){delete this.callbacks[e]},p=function(e){var t=1e3*(Math.pow(2,e)-1);return t>3e4&&(t=3e4),Math.random()*t};return{init:l,createWebSocket:s,sendMessage:u,generateInterval:p,dispatchMessage:c,removeTag:d}}]),angular.module("app.shared").controller("TestingController",["$scope",function(){}]).controller("AboutController",["$scope",function(){}]),angular.module("app.shared.system").service("globalVariablesSrv",["$timeout",function(e){var t={currTimeVal:(new Date).getTime(),currTimeValUTC:moment().utc().valueOf()};return e(function(){t.currTimeVal=(new Date).getTime(),t.currTimeValUTC=moment().utc().valueOf()},1e3),{getVar:function(e){return t[e]}}}]).service("onlineUtils",["$window","$rootScope",function(e,t){return t.online=navigator.onLine,e.addEventListener("offline",function(){t.$apply(function(){t.online=!1})},!1),e.addEventListener("online",function(){t.$apply(function(){t.online=!0})},!1),{isOnline:function(){return t.db.active?t.online:!1}}}]).service("generalUtils",[function(){var e=function(e,t){if(+e)for(;e.getDate()!==t.getDate();)e.setTime(+e+36e5*(t>e?1:-1))};return{parseISO8601:function(t,n){var r=t.match(/^([0-9]{4})(-([0-9]{2})(-([0-9]{2})([T ]([0-9]{2}):([0-9]{2})(:([0-9]{2})(\.([0-9]+))?)?(Z|(([-+])([0-9]{2})(:?([0-9]{2}))?))?)?)?)?$/);if(!r)return null;var i=new Date(r[1],0,1);if(n||!r[13]){var o=new Date(r[1],0,1,9,0);r[3]&&(i.setMonth(r[3]-1),o.setMonth(r[3]-1)),r[5]&&(i.setDate(r[5]),o.setDate(r[5])),e(i,o),r[7]&&i.setHours(r[7]),r[8]&&i.setMinutes(r[8]),r[10]&&i.setSeconds(r[10]),r[12]&&i.setMilliseconds(1e3*Number("0."+r[12])),e(i,o)}else if(i.setUTCFullYear(r[1],r[3]?r[3]-1:0,r[5]||1),i.setUTCHours(r[7]||0,r[8]||0,r[10]||0,r[12]?1e3*Number("0."+r[12]):0),r[14]){var a=60*Number(r[16])+(r[18]?Number(r[18]):0);a*="-"===r[15]?1:-1,i=new Date(+i+1e3*60*a)}return i},one_day:864e5,one_hour:36e5}}]).service("localStorageService",["onlineUtils","$rootScope",function(e,t){var n="WP-",r=function(e,r){var i=n+e;return!r&&t&&t.account&&t.account.name&&(i=t.account.name+"_"+i),i};this.getItem=function(e,t){return localStorage.getItem(r(e,t))},this.setItem=function(e,t,n){return localStorage.setItem(r(e,n),JSON.stringify(t))}}]),angular.module("app.marketplace.templates",[]).run(["$templateCache",function(e){e.put("templates/marketplace/main/mainPage.html",'<div id=mainPage class=mainPage ng-controller=SystemController>Test8 <span ng-repeat="product in products" style=float:left;width:100%>{{product.name}}</span></div>'),e.put("templates/shared/support/about.html","<div id=aboutPage><header></header><div data-role=content>Hope this was helpful. <button ng-click=reset()>Reset LocalStorage</button></div></div>"),e.put("templates/shared/support/testing-state1.html","<div>State1</div>"),e.put("templates/shared/support/testing.html","<div class=simpleDemo>Test page</div>")}]);