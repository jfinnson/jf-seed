/*! jf-seed - v0.0.1 - 2015-07-17
 * Copyright (c) 2015 ; */angular.module("app",["app.config","app.marketplace.templates","ngRoute","app.shared","app.marketplace"]).config(["$routeProvider","$locationProvider",function(e){e.when("/",{templateUrl:"templates/marketplace/main/mainPage.html",controller:"SystemController",page:"main"}).when("/about",{templateUrl:"templates/shared/support/about.html",controller:"AboutController",page:"about"}).when("/test",{templateUrl:"templates/shared/support/testing.html",controller:"TestingController",page:"testing"}).otherwise({redirectTo:"/"}),$(document).bind("pagebeforechange",function(e,t){var n=t.toPage,i=t.options.fromPage;n&&n.attr&&i&&i.attr&&n.attr("id")===i.attr("id")&&e.preventDefault()})}]).run(["$route","$rootScope","$location","$timeout","$window","$compile","apiUrl",function(e,t,n){t.$on("$routeChangeSuccess",function(){});var i=n.path;n.path=function(r){var o=e.current,a=t.$on("$locationChangeSuccess",function(){e.current&&e.current.params&&o!==e.current&&(t.currentRoute=e.current.params),o&&""!==o.$$route.originalPath&&(e.current=o),a()});return i.apply(n,[r])},window.checkNested=function(e){for(var t=Array.prototype.slice.call(arguments,1),n=0;t.length>n;n++){if(!e||!e.hasOwnProperty(t[n]))return!1;e=e[t[n]]}return!0}}]),angular.module("app.config",[]).constant("apiUrl","http://localhost:5000").constant("marketplaceUrl","http://localhost:8000").constant("searchUrl","http://localhost:9200").constant("apiKey","77dc92d4-2368-498b-a8a2-cb359e637f5b").constant("apiSecret","571c91e3c18b45178df98a32").constant("TemplatePaths",{marketplace:"marketplace",shared:"shared"}).constant("membershipTypes",[{id:"team",name:"Team Member"},{id:"manager",name:"Manager"},{id:"executive",name:"Executive"},{id:"master",name:"Master"}]).constant("defaultPaginationOptions",{currentPage:1,totalItems:1,maxSize:5,itemsPerPage:20}),angular.module("app.marketplace.elements",["app.config"]),angular.module("app.marketplace",["app.config","app.marketplace.system","app.marketplace.support","app.marketplace.elements","ui.keypress"]),angular.module("app.marketplace.support",[]),angular.module("app.marketplace.system",[]),angular.module("app.marketplace.ui",[]),angular.module("app.shared",["app.config","ui.keypress","app.shared.ui","app.shared.system","app.shared.support"]),angular.module("app.shared.support",[]),angular.module("app.shared.system.api",[]),angular.module("app.shared.system",["app.shared.system.api"]),angular.module("app.shared.ui",[]),angular.module("app.marketplace.elements").service("accountModel",["serverAPI",function(){this.model_data={name:"account",display_name:"Account",api:{multiple:function(){return"accounts"},single:function(e){if(!checkNested(e,"data","account_id"))throw"Missing option(s) for account path 'single'. Options: "+e;return"account/"+e.data.account_id}},STORAGE_ID:"account",STORAGE_ID_LAST:"account-LastLogin",table_display:{}},this.fields={id:{display_name:"id",required:!0,api:{submit:!0},type:"string"},name:{display_name:"Login name",required:!0,api:{submit:!0},type:"string"},password:{display_name:"Login password",required:!0,api:{submit:!0},type:"password"},type:{display_name:"Login type",required:!1,type:"code",values:[{name:"admin",display_name:"Admin"}],api:{submit:!0}}},this.data={params:{model_name:"account"}}}]),angular.module("app").service("accountService",[function(){}]),angular.module("app.marketplace.elements").service("eleTreeManager",["serverAPI","apiUtils",function(){this.modelData={name:"eleTree",STORAGE_ID:"eleTree"},this.eleTree={params:{name:"eleTree",server:!1,fields:{treeMap:{display_name:"treeMap",type:"hashmap"},treeArrayMap:{display_name:"treeArrayMap",type:"hashmap"},rootType:{display_name:"rootType",type:"text"},exceptionType:{display_name:"rootType",type:"text"}}},f_data:{treeMap:{0:{}},treeArrayMap:{0:[]}},createTree:function(e){var t=null,n=null,i=this;for(var r in e)t=e[r],n=t.f_data.parentKey||t.f_data.parent_luid,!n&&t.f_data.parent_vLuid?n="v"+t.f_data.parent_vLuid:n||(n=this.f_data.rootType?t.f_data.type===this.f_data.rootType?0:null:0),null!==n&&(this.f_data.treeMap[n]||(this.f_data.treeMap[n]={},this.f_data.treeArrayMap[n]=[]),n&&e[n]&&(e[n].f_data.hasChildren=!0),this.f_data.treeMap[n][r]=t);var o=null,a=null,l=null,s=null,u=null,c=!1,d=null;for(r in this.f_data.treeMap){for(o=$.extend(!0,{},this.f_data.treeMap[r]),a=this.f_data.treeArrayMap[r],l=0,s=0,u=Object.keys(o).length;0!==Object.keys(o).length&&u*u>s;){if(d=Object.keys(o)[l],t=this.f_data.treeMap[r][d],c=!1,t.f_data.key||(t.f_data.key=d),i.f_data.rootType&&t.f_data.type!==i.f_data.rootType&&"0"===r)i.f_data.exceptionType&&t.f_data[i.f_data.exceptionType]||(this.f_data.treeArrayMap.misc||(this.f_data.treeArrayMap.misc=[]),this.f_data.treeArrayMap.misc.push(t)),c=!0;else if(t.f_data.previousKey){var p=null;for(var g in a)if(p=a[g],p.f_data.key===t.f_data.previousKey){a.splice(parseInt(g,10)+1,0,t),c=!0;break}}else a.length?(a.splice(0,0,t),c=!0):(a.push(t),c=!0);c&&delete o[d],l++,s++,l>=Object.keys(o).length&&(l=0)}if(Object.keys(o).length){this.f_data.treeArrayMap.misc||(this.f_data.treeArrayMap.misc=[]);for(var f in o)this.f_data.treeArrayMap.misc.push(o[f])}}this.eles=e},getTree:function(){return this.f_data.treeArrayMap},createKey:function(e,t){for(var n=0;!e.f_data.key||t[e.f_data.key]&&t[e.f_data.key]!==e;)e.f_data.key=e.f_data.luid||"v"+(e.f_data.vLuid+n),n>0&&e.f_data.luid,n++},addEle:function(e,t){if(!e||!e.f_data.key)return null;var n=0;if(t&&(t.f_data.luid?(e.f_data.parent_luid=t.f_data.luid,e.f_data.parentKey=t.f_data.luid):(e.f_data.parent_vLuid=t.f_data.vLuid,e.f_data.parentKey=t.f_data.key||"v"+e.f_data.parent_vLuid),n=e.f_data.parentKey,e.f_data.parent_ele=t,t.f_data.hasChildren=!0),this.f_data.treeMap[n]||(this.f_data.treeMap[n]={}),this.f_data.treeArrayMap[n]||(this.f_data.treeArrayMap[n]=[]),this.f_data.treeMap[n][e.f_data.key]=e,this.f_data.treeArrayMap[n].push(e),this.f_data.treeArrayMap[n].length>1){var i=this.f_data.treeArrayMap[n][this.f_data.treeArrayMap[n].length-2];e.f_data.previous_luid=i.f_data.luid,e.f_data.previousKey=i.f_data.key}},removeEle:function(e){if(!e)return!1;var t=e.f_data.parentKey||0;delete this.f_data.treeMap[t][e.f_data.key];var n=this.f_data.treeArrayMap[t];for(var i in n)if(n[i]===e){if(i=parseInt(i,10),n.length>i+1){var r=i>0?n[i-1].f_data.luid:null,o=i>0?n[i-1].f_data.key:null;n[i+1].f_data.previous_luid=r,n[i+1].f_data.previousKey=o}n.splice(i,1)}},updateEle:function(e,t,n,i,r,o){if(!e||!t&&!n||null===i||void 0===i||!r||null===o||void 0===o)return console.log("error: updateEle",arguments),!1;o=parseInt(o,10);var a=this.eles[e],l=a.f_data.parentKey,s=0;n&&(s=n.f_data.key);var u=null;if(n&&(u=n.f_data.luid),!t&&s){var c=s;this.f_data.treeMap[c]||(this.f_data.treeMap[c]={}),this.f_data.treeArrayMap[c]||(this.f_data.treeArrayMap[c]=[]),t=this.f_data.treeArrayMap[c],n.open=!0}if(t!==r){var d=this.f_data.treeMap[a.f_data.parentKey||0],p=this.f_data.treeMap[s];p[e]=d[e],delete d[e],a.f_data.parentKey=s,a.f_data.parent_luid=u}if(t!==r||o!==i){var g=null,f=null;t.length>i&&(g=a.f_data.luid,f=a.f_data.key,t[i].f_data.previous_luid=g,t[i].f_data.previousKey=f),r.length>o+1&&(g=o>0?r[o-1].f_data.luid:null,f=o>0?r[o-1].f_data.key:null,r[o+1].f_data.previous_luid=g,r[o+1].f_data.previousKey=f),i>0?(g=t[i-1].f_data.luid,f=t[i-1].f_data.key,a.f_data.previous_luid=g,a.f_data.previousKey=f):(a.f_data.previous_luid=null,a.f_data.previousKey=null)}!t.length&&n&&(n.f_data.hasChildren=!0),t.splice(i,0,r.splice(o,1)[0]),!r.length&&r!==t&&l&&(this.eles[l].f_data.hasChildren=!1)}}}]),angular.module("app.marketplace.elements").service("elementSrv",["onlineUtils","serverAPI","accountModel","productModel","$rootScope","$q","$timeout","apiUrl",function(e,t,n,i,r,o,a,l){var s={account:n,product:i},u={},c={},d=[],p=null;for(var g in s)u[g]=1,c[g]={},d.push(g);var f=null,h=null,m=null,v=function(e){return e&&s[e]?s[e]:!1},w=function(e,t){t||(t={});var n=$.extend(!0,t||{},e.data);C(e,n),e.autofill&&e.autofill(n),n.vID=u[e.model_data.name]++;var i=n.id||"v"+n.vID,r=c[e.model_data.name][i]&&c[e.model_data.name][i].UI?c[e.model_data.name][i].UI:{};return n.UI=r,c[e.model_data.name][i]=n,n},b=function(e,t){if(e&&e.length&&t)for(var n in e)e[n]=w(t,e[n]);return e},C=function(e,t){t.get=function(n){if(!e.fields[n])throw"Field "+n+" does not exist in model.";return y(e,t,n),t[n]},t.set=function(n,i){if(!e.fields[n])throw"Field "+n+" does not exist in model.";"object"===e.fields[n].type||"array"===e.fields[n].type?i&&angular.copy(i,t[n]):t[n]=i},t.getFieldParams=function(t){if(!e.fields[t])throw"Field "+t+" does not exist in "+e.model_data.name+" model.";return e.fields[t]}},y=function(e,t,n){var i=e.fields[n].type;t[n]||("object"===i&&(t[n]={}),"array"===i&&(t[n]=[]),e.fields[n].default_value&&(t[n]="object"===i||"array"===i?$.extend(!0,t[n],e.fields[n].default_value):e.fields[n].default_value))},x=function(e,t){if(!e||!e||!t)return!1;var n=v(t)[t],i=n.fields,r=e.b_data||{},o={},a=null;for(var l in e)a=n.fields[l],a&&a.api&&a.api.submit&&(!i||i[l])&&(r[l]=e[l],o[l]=e[l]);return o},S=function(e,n,i){if(!e||!n&&!i||!i.pathType||"single"===i.pathType&&!i.id)throw"Missing field or option for api get.";if(!(!n||i&&i.forceAPI)&&c[e][n])return o(function(t){t(c[e][n])});n&&(i||(i={}),i.pathType="single");var r=v(e);if(!r.model_data.api||!r.model_data.api[i.pathType])throw"Path type, "+i.pathType+", does not exist for "+e;var a=r.model_data.api[i.pathType](i);return a===!1?!1:(a=l+a,t.doAPICall(a,i).then(function(e){if(!e||e.success===!1||"failed"===e.success)throw"Path "+a+" returned a failure response.";var t=e.data?e.data:e;if(t){$.isArray(t)||(t=[t]);var n={};for(var i in t){var o=t[i];o.b_data=$.extend(!0,{},t[i]),o=w(r,o),n[o.id]=o}return b(n,r)}}))},E=function(e,t){if(!e||!v(e))throw"_getEles: Missing eleType.";return v(e),t||(t={}),t.pathType||(t.pathType="multiple"),S(e,null,t)};h=function(e,n){if(!e||!n||!n.pathType||"single"===n.pathType&&!n.ele)throw"_submit: Missing field or option.";var i=v(e);if(!i.model_data.api||!i.model_data.api[n.pathType])throw"Path type, "+n.pathType+", does not exist for "+e;var r=[];!n.eles&&n.ele?r.push(n.ele):n.eles&&(r=n.eles);var a=function(n,i,r){return t.doAPICall(n,i).then(function(t){if(!t||t.success===!1||"failed"===t.success)throw"Path "+n+" returned a failure response.";var i=t.data?t.data:t;if(i){var o=m(r,i);c[e][o.id]=o}})},l=[],s=null,u=null;for(var d in r){s=r[d],u={},u.isAsync=!0;var p=x(s,e,n);u=$.extend(u,p);var g=i.model_data.api[n.pathType](u);if(g===!1)return!1;l.push(a(g,u,s))}return l&&l.length>0?o.all(l).then(function(e){return e&&1===e.length?e[0]:e}):!0},f=function(e,t,n){if(n||(n={}),!e||!t)throw"_validateFields: Missing type or instance.";var i=v(e),r=null,o=[];for(var a in i.fields)r={pass:!0},r&&r.pass||o.push(r);return o.length>0?o[0]:{pass:!0}},m=function(e,t){return e.b_data=$.extend(!0,e.b_data||{},t),e=$.extend(!0,e||{},t)};var T=function(e,n,i){var r=v(e);if(!e||!n||!r)throw"_remove: Missing type, model, or instance.";if(i&&(!r.model_data.api||!r.model_data.api.remove))throw"_remove: Missing remove api path type.";if(i&&n.id){var o=r.model_data.api.remove(n);return o===!1?!1:t.doAPICall(o,n).then(function(t){if(!t||t.success===!1||"failed"===t.success)throw"Path "+o+" returned a failure response.";delete c[e][n.id]})}return delete c[e][n.id],!0},k=function(){for(var e in s);},R=function(){},D=function(){r.get=S},A=function(){k(),D(),R()};return{initService:A,create:w,remove:T,validateFields:f,get:S,getEles:E,submit:h,eleNameMap:s,eleTypeList:d,eleMaps:c,eles:p}}]),angular.module("app").service("productModel",[function(){this.model_data={name:"product",display_name:"Product",api:{multiple:function(){return"/products"},single:function(e){if(!checkNested(e,"data","product_id"))throw"Missing option(s) for account path 'single'. Options: "+e;return"/product/"+e.data.product_id}}},this.autofill=function(){},this.fields={id:{display_name:"id",required:!0,api:{submit:!0},type:"integer"},name:{display_name:"name",required:!0,api:{submit:!0},type:"text"}},this.data={params:{model_name:"appliance"},getStatus:function(){return this.last_state}}}]),angular.module("d3",[]).factory("d3Service",["$document","$window","$q","$rootScope",function(e,t,n,i){function r(){i.$apply(function(){o.resolve(t.d3)})}var o=n.defer(),a={d3:function(){return o.promise}},l=e[0].createElement("script");l.type="text/javascript",l.async=!0,l.src="http://d3js.org/d3.v3.js",l.onreadystatechange=function(){"complete"===this.readyState&&r()},l.onload=r;var s=e[0].getElementsByTagName("body")[0];return s.appendChild(l),a}]),angular.module("app.marketplace.system").controller("SystemController",["$scope","$location","elementSrv",function(e,t,n){n.initService(),n.getEles("product").then(function(t){e.products=t}),e.$watch("account.id",function(e,t){})}]),angular.module("app.marketplace.system").service("systemService",[function(){}]),angular.module("app.shared.support").controller("AlertCtrl",["$scope","alertSrv",function(e,t){e.alertSrv=t,e.closeAlert=function(){e.alert=null}}]),angular.module("app.shared.support").service("alertSrv",["$timeout",function(e){var t=function(n,i,o,a,l){return r&&!a?(n.alert={type:"info",msg:""},e(function(){t(n,i,o,!0,l)},1e3),!1):(n.alert={type:o||"error",msg:i},n.showOverrideOpt=l,void 0)},n=function(e){e.alert.msg=""},i=0,r=!1;return{timedChange:function(n,o,a,l){i++;var s=i;r=!0,e(function(){s===i&&(t(n,o,a),r=!1)},l)},setAlert:t,closeAlert:n}}]),angular.module("app.shared").directive("ngRightClick",["$parse",function(e){return function(t,n,i){var r=e(i.ngRightClick);n.bind("contextmenu",function(e){t.$apply(function(){e.preventDefault(),r(t,{$event:e})})})}}]).directive("jfBlur",["$document",function(e){return{restrict:"A",link:function(t,n,i){n.bind("click",function(e){e.stopPropagation()}),t.$watch(i.jfBlur,function(n,r){if(n!==r&&n){var o=!0;e.bind("click",function(e){o||(t[i.jfBlur]=!1,$(this).unbind(e),t.$apply()),o=!1})}})}}}]),angular.module("app.shared.system.api").service("serverAPI",["$http",function(e){var t=function(t,n){if(!t)throw"Empty fromUrl passed";return n||(n={}),e({url:t,async:n.isAsync||!1,dataType:n.dataType,data:n.dataContent,method:n.method||"GET"}).success(function(){}).error(function(e,n){throw"Error with api call: "+t+". Error status: "+n})};return{doAPICall:t}}]),angular.module("app.shared.system.api").service("socketSrv",["$rootScope",function(e){var t=null,n=1,i=0,r={},o=null,a=e,l=function(e,t){o=e,t&&(a=t),s()},s=function(){return o?(t=new WebSocket(o),t.onopen=function(){a.$emit("websocket-status",{status:"open",message:"Websocket Open"}),console.log("Opened websocket"),n=1,this.send('{ "type": "login", "account_type": "client", "token" : "'+e.account.token+'"}')},t.onclose=function(){a.$emit("websocket-status",{status:"error",message:"Websocket closed"});var e=p(n);setTimeout(function(){n++,s()},e)},t.onerror=function(e){a.$emit("websocket-status",{status:"error",message:"Websocket error"}),console.log("Websocket error: "+e)},t.onmessage=function(e){console.log("Websocket message: ",e.data);var t=JSON.parse(e.data);$.isPlainObject(t)&&t.body&&(t.body.datetime=""+new Date,t.body.id=i++),c(t)},void 0):!1},u=function(e,n,i){"tag"in e&&(e.tag in this.callbacks&&console.log("Problem! Tag already exists in callbacks"),this.callbacks[e.tag]={timeout:i||60,callback:n}),t.send(JSON.stringify(e))},c=function(e){switch(e.type){case"command_response":e.command_tag in r?r[e.command_tag].callback(e):console.log("No callback for tag <"+e.tag+"> in the callback queue");break;case"command":break;case"status_update":a.$emit("websocket-status_update",e.body);break;default:console.log("Unknown message from websocket")}},d=function(e){delete this.callbacks[e]},p=function(e){var t=1e3*(Math.pow(2,e)-1);return t>3e4&&(t=3e4),Math.random()*t};return{init:l,createWebSocket:s,sendMessage:u,generateInterval:p,dispatchMessage:c,removeTag:d}}]),angular.module("app.shared").controller("TestingController",["$scope",function(){}]).controller("AboutController",["$scope",function(){}]),angular.module("app.shared.system").service("globalVariablesSrv",["$timeout",function(e){var t={currTimeVal:(new Date).getTime(),currTimeValUTC:moment().utc().valueOf()};return e(function(){t.currTimeVal=(new Date).getTime(),t.currTimeValUTC=moment().utc().valueOf()},1e3),{getVar:function(e){return t[e]}}}]).service("onlineUtils",["$window","$rootScope",function(e,t){return t.online=navigator.onLine,e.addEventListener("offline",function(){t.$apply(function(){t.online=!1})},!1),e.addEventListener("online",function(){t.$apply(function(){t.online=!0})},!1),{isOnline:function(){return t.db.active?t.online:!1}}}]).service("generalUtils",[function(){var e=function(e,t){if(+e)for(;e.getDate()!==t.getDate();)e.setTime(+e+36e5*(t>e?1:-1))};return{parseISO8601:function(t,n){var i=t.match(/^([0-9]{4})(-([0-9]{2})(-([0-9]{2})([T ]([0-9]{2}):([0-9]{2})(:([0-9]{2})(\.([0-9]+))?)?(Z|(([-+])([0-9]{2})(:?([0-9]{2}))?))?)?)?)?$/);if(!i)return null;var r=new Date(i[1],0,1);if(n||!i[13]){var o=new Date(i[1],0,1,9,0);i[3]&&(r.setMonth(i[3]-1),o.setMonth(i[3]-1)),i[5]&&(r.setDate(i[5]),o.setDate(i[5])),e(r,o),i[7]&&r.setHours(i[7]),i[8]&&r.setMinutes(i[8]),i[10]&&r.setSeconds(i[10]),i[12]&&r.setMilliseconds(1e3*Number("0."+i[12])),e(r,o)}else if(r.setUTCFullYear(i[1],i[3]?i[3]-1:0,i[5]||1),r.setUTCHours(i[7]||0,i[8]||0,i[10]||0,i[12]?1e3*Number("0."+i[12]):0),i[14]){var a=60*Number(i[16])+(i[18]?Number(i[18]):0);a*="-"===i[15]?1:-1,r=new Date(+r+1e3*60*a)}return r},one_day:864e5,one_hour:36e5}}]).service("localStorageService",["onlineUtils","$rootScope",function(e,t){var n="WP-",i=function(e,i){var r=n+e;return!i&&t&&t.account&&t.account.name&&(r=t.account.name+"_"+r),r};this.getItem=function(e,t){return localStorage.getItem(i(e,t))},this.setItem=function(e,t,n){return localStorage.setItem(i(e,n),JSON.stringify(t))}}]),angular.module("app.marketplace.templates",[]).run(["$templateCache",function(e){e.put("templates/marketplace/main/mainPage.html",'<div id=mainPage class=mainPage ng-controller=SystemController>Test8 <span ng-repeat="product in products" style=float:left;width:100%>{{product.name}}</span></div>'),e.put("templates/shared/support/about.html","<div id=aboutPage><header></header><div data-role=content>Hope this was helpful. <button ng-click=reset()>Reset LocalStorage</button></div></div>"),e.put("templates/shared/support/testing.html","<div class=simpleDemo>Test page</div>")}]);